<!DOCTYPE html>
<html lang="it"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/springsecurity6"
      th:replace="base :: content">

<head>
  <title>Modifica Libro | SiwBooks</title>
</head>
<body>
<section class="content">
  <h1>Modifica Libro</h1>

  <!-- Errori di validazione -->
  <div th:if="${#fields.hasErrors('*')}" class="message error">
    <p>Ci sono errori nei campi. Correggili e riprova.</p>
  </div>

  <form th:action="@{/books/edit/{id}(id=${book.id})}"
        th:object="${book}" method="post" enctype="multipart/form-data">

    <div class="form-group">
      <label for="title">Titolo</label>
      <input type="text" id="title" th:field="*{title}" required />
      <p th:if="${#fields.hasErrors('title')}" th:errors="*{title}" class="field-error"></p>
    </div>

    <div class="form-group">
      <label for="publicationYear">Anno di pubblicazione</label>
      <input type="number" id="publicationYear" th:field="*{publicationYear}" required />
      <p th:if="${#fields.hasErrors('publicationYear')}" th:errors="*{publicationYear}" class="field-error"></p>
    </div>

    <div class="form-group">
      <label for="synopsis">Sinossi</label>
      <textarea id="synopsis" rows="4" th:field="*{synopsis}"></textarea>
    </div>

    <!-- Immagine attuale -->
    <div th:if="${book.imagePath}" class="form-group">
      <label>Copertina attuale:</label><br/>
      <img th:src="@{${book.imagePath}}" alt="Copertina" style="max-height: 150px;" />
    </div>

    <!-- Caricamento nuova immagine -->
    <div class="form-group">
      <label for="imageFile">Nuova immagine (opzionale)</label>
      <input type="file" id="imageFile" name="imageFile" accept="image/*" />
    </div>

    <div class="form-group">
      <label for="authors">Autori</label>
      <select id="authors" name="authorIds" multiple>
        <option th:each="author : ${authors}"
                th:value="${author.id}"
                th:text="${author.firstName + ' ' + author.lastName}"
                th:selected="${book.authors.contains(author)}">
        </option>
      </select>
    </div>

    <div class="button-group">
      <button type="submit" class="btn">Aggiorna Libro</button>
      <a th:href="@{/books/{id}(id=${book.id})}" class="btn btn-secondary">Annulla</a>
    </div>
  </form>
</section>
</body>
</html>
